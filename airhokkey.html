<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>AIR-HOCKEY</title>
  <link rel="shortcut icon" href="https://lh3.googleusercontent.com/ogw/ADGmqu_sTgrOdD83eGalXC87hA_tP9CbRON-Q2vnjYp6=s64-c-mo" type="image/png">
</head>
<body style="margin: 0">
<canvas id="canvas">Upload Browser!</canvas>
<script>
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');

  canvas.width = innerWidth;
  canvas.height = innerHeight;

  let v;
  let i = 0;
  let d = 0;
  let isgp = 0;
  let bool = 0;
  let mode = 0;
  let dir;
  let dir2 = 0;
  let rpx = 100;
  let l = 10;
  let r = 15;
  let s = 1;
  let r2 = 20;
  let s2 = 1;
  let score = 0;
  let scoreBot = 0;
  let neironball;
  let neironballI;
  let touchPosition = null;
  let posY = canvas.height / 2.3;
  let posYBot = canvas.height / 2.3;
  console.log(posY);
  let posYBotC = posYBot;
  console.log(posYBotC);
  //posYBotC -= (canvas.height/(l*2));
  let posYBotCI;
  let posYI;
  let end;
  let game;
  let rect1 = new Path2D();
  let rect2 = new Path2D();
  let rect3 = new Path2D();
  let arc = [];
    arc[0] = {
      x: canvas.width / 2,
      y: canvas.height / 2,
    };
  let rectN = [];
  let rectN1 = [];
  let grad = ctx.createLinearGradient(0,0,innerWidth,innerHeight/2);
  grad.addColorStop('0','#b2ffe7');
  grad.addColorStop('1', '#00cbba')
  //game = setInterval(drawBackGround , 500);





  //end = setInterval(start_end , 3000);
  start_end();
  function start_end() {
    ctx.clearRect(0, 0, innerWidth, innerHeight);
    console.log("bool: " + bool);
    canvas.width = innerWidth;
    canvas.height = innerHeight;
    // window.addEventListener("gamepadconnected", function (e) {
    //   console.log(
    //           e.gamepad.buttons.indexOf, e.gamepad.axes.values);
    //   //for(let i = 0; i <= 17; i++ ){
    //   //if(gp.buttons[i].value > 0){
    //   //console.log("checked!!!");
    //   //}
    //   isgp = 2;
    //   let gpad = navigator.getGamepads()[0];
    //   //console.log(e);
    //   //let myActuatorType = GamepadHapticActuator.type;
    //   //console.log("myActuatorType: " + myActuatorType);
    //   //GamepadHapticActuator.pulse(1, 1000);
    //   //console.log(e);
    //   //isgp = 1;
    //   // if(navigator.webkitGetGamepads) {
    //   //   let gp = navigator.webkitGetGamepads()[0];
    //   //   console.log('con');
    //   //   if(gp.buttons[0] == 1) {
    //   //     console.log("A");
    //   //     posY += canvas.height / (rpx * 0.2);
    //   //   } else if(gp.buttons[1] == 1) {
    //   //     console.log("B");
    //   //     posY -= canvas.height / (rpx * 0.2);
    //   //   } else if(gp.buttons[2] == 1) {
    //   //     console.log("Y");
    //   //     posYBotC -= canvas.height / (rpx * 0.2);
    //   //   } else if(gp.buttons[3] == 1) {
    //   //     console.log("X");
    //   //     posYBotC += canvas.height / (rpx * 0.2);
    //   //   }
    //   // }else {
    //   //   let gp = navigator.getGamepads()[0];
    //   //
    //   //   if(gp.buttons[0].value > 0 || gp.buttons[0].pressed == true) {
    //   //     console.log("A");
    //   //     posY += canvas.height / (rpx * 0.2);
    //   //   } else if(gp.buttons[1].value > 0 || gp.buttons[1].pressed == true) {
    //   //     console.log("B");
    //   //     posY -= canvas.height / (rpx * 0.2);
    //   //   } else if(gp.buttons[2].value > 0 || gp.buttons[2].pressed == true) {
    //   //     console.log("X");
    //   //     posYBotC -= canvas.height / (rpx * 0.2);
    //   //   } else if(gp.buttons[3].value > 0 || gp.buttons[3].pressed == true) {
    //   //     console.log("Y");
    //   //     posYBotC += canvas.height / (rpx * 0.2);
    //   //   }
    //   // }
    //   //const xBoxButtonX = Gamepad.button[2];
    //   //const xBoxButtonA = Gamepad.buttons[0];
    //   //const xBoxButtonY = Gamepad.buttons[3];
    //   //const xBoxButtonUp = Gamepad.buttons[12];
    //   //const xBoxButtonLow = Gamepad.buttons[13];
    //   //if (xBoxButtonX.pressed) {
    //   // if(dir2 == 0) {
    //   //  dir2 = 3;
    //   //}
    //   //}
    //   //if (xBoxButtonA.pressed) {
    //   // posY += canvas.height / (rpx * 0.5);
    //   //}
    //   //if (xBoxButtonY.pressed) {
    //   // posY -= canvas.height / (rpx * 0.5);
    //   // }
    //   //if(mode == 1) {
    //   // if (xBoxButtonUp.pressed) {
    //   //  posYBotC -= canvas.height / (rpx * 0.5);
    //   //}
    //   //if (xBoxButtonLow.pressed) {
    //   //  posYBotC += canvas.height / (rpx * 0.5);
    //   //}
    //   //}
    // });
    // while (bool == 0) {
    if (bool == 0) {
      //ctx.clearRect(0, 0, innerWidth, innerHeight);
      console.log("bool: " + bool);
      console.log("bool: " + bool);
      canvas.width = innerWidth;
      canvas.height = innerHeight;
      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      console.log("bool: " + bool);
      ctx.fillStyle = '#fff17d';
      //ctx.font = '84px Comic Sans MS';
      //ctx.textAlign = "left";
      ctx.textAlign = 'center';
      ctx.font = '640% Trebuchet MS';
      ctx.fillText('< AIR HOCKEY >', canvas.width / 2, canvas.height / 7, canvas.width / 1.3);
      ctx.fillStyle = '#ffffff';
      ctx.font = '500% Trebuchet MS';
      ctx.textAlign = 'center';
      ctx.fillText('MENU', canvas.width / 2, canvas.height / 3, canvas.width / 5);
      ctx.fillStyle = '#00b7d7';
      rect1.rect(canvas.width / 3.3, canvas.height / 2.5, canvas.width / 2.5, canvas.height / 10);
      ctx.fill(rect1);
      ctx.fillStyle = '#00b7d7';
      rect2.rect(canvas.width / 3.3, (canvas.height / 2.5) + (canvas.height / 7), canvas.width / 2.5, canvas.height / 10);
      ctx.fill(rect2);
      ctx.fillStyle = '#00b7d7';
      rect3.rect(canvas.width / 3.3, (canvas.height / 2.5) + ((canvas.height / 7) * 2), canvas.width / 2.5, canvas.height / 10);
      ctx.fill(rect3);
      ctx.fillStyle = '#ffffff';
      ctx.font = '250% Trebuchet MS';
      ctx.textAlign = 'center';
      ctx.fillText('PLAYER/PLAYER', canvas.width / 2, canvas.height / 2.15, canvas.width / 3);
      ctx.fillText('BOT/PLAYER', canvas.width / 2, canvas.height / 2.15 + (canvas.height / 7), canvas.width / 3);
      ctx.fillText('BOT/BOT', canvas.width / 2, canvas.height / 2.15 + ((canvas.height / 7) * 2), canvas.width / 3);
      canvas.addEventListener('mousedown', direction2);

      console.log("bool: " + bool);
      // let gpad = navigator.getGamepads()[0];
      // if(isgp == 2){
      //   if (gpad.buttons[2].value > 0 || gpad.buttons[2].pressed == true || gpad.buttons[2].value > 0 || gpad.buttons[2].pressed == true) {
      //       console.log("posY: " + posY);
      //       console.log("posYBotC: " + posYBotC);
      //       //dir2 = 3;
      //     mode = 1;
      //     ctx.clearRect(0, 0, innerWidth, innerHeight);
      //     bool = 1;
      //     console.log("bool: " + bool);
      //     //drawBackGround();
      //     //clearInterval(end);
      //     return draw();
      //     //game = setInterval(drawBackGround, 50);
      //
      //   }
      //   if (gpad.buttons[0].value > 0 || gpad.buttons[3].pressed == true || gpad.buttons[0].value > 0 || gpad.buttons[3].pressed == true) {
      //     console.log("posY: " + posY);
      //     console.log("posYBotC: " + posYBotC);
      //     //dir2 = 3;
      //     mode = 2;
      //     ctx.clearRect(0, 0, innerWidth, innerHeight);
      //     bool = 1;
      //     console.log("bool: " + bool);
      //     //drawBackGround();
      //     //clearInterval(end);
      //     return draw();
      //     //game = setInterval(drawBackGround, 50);
      //
      //   }
      //   if (gpad.buttons[0].value > 0 || gpad.buttons[1].pressed == true || gpad.buttons[0].value > 0 || gpad.buttons[1].pressed == true) {
      //     console.log("posY: " + posY);
      //     console.log("posYBotC: " + posYBotC);
      //     //dir2 = 3;
      //     mode = 2;
      //     ctx.clearRect(0, 0, innerWidth, innerHeight);
      //     bool = 1;
      //     console.log("bool: " + bool);
      //     //drawBackGround();
      //     //clearInterval(end);
      //     return draw();
      //     //game = setInterval(drawBackGround, 50);
      //
      //   }
      // }



      function direction2(event) {
        console.log("bool: " + bool);
        if (bool == 0) {
          console.log("bool: " + bool);
          if (ctx.isPointInPath(rect1, event.offsetX, event.offsetY)) {
            mode = 1;
            ctx.clearRect(0, 0, innerWidth, innerHeight);
            bool = 1;
            console.log("bool: " + bool);
            //drawBackGround();
            //clearInterval(end);
            return draw();
            //game = setInterval(drawBackGround, 50);
          }
          if (ctx.isPointInPath(rect2, event.offsetX, event.offsetY)) {
            mode = 2;
            ctx.clearRect(0, 0, innerWidth, innerHeight);
            bool = 1;
           //posY += (canvas.height/(l*2));
            console.log("bool: " + bool);
            //drawBackGround();
            //break;
            //clearInterval(end);
            return draw();
            //game = setInterval(drawBackGround, 50);
          }
          if (ctx.isPointInPath(rect3, event.offsetX, event.offsetY)) {
            mode = 3;
            ctx.clearRect(0, 0, innerWidth, innerHeight);
            bool = 1;
            console.log("bool: " + bool);
            //drawBackGround();
            //break;
            //clearInterval(end);
            return draw();
            //game = setInterval(drawBackGround, 50);
          }
          //if(r == 1) {
          //ctx.clearRect(0, 0, innerWidth, innerHeight);
          //clearInterval(end);
          //console.log(r);
          //location.reload();
        }
      }

      console.log("bool: " + bool);
      //}
      console.log("bool: " + bool);

      //requestAnimationFrame(start_end);
      // }
      //drawBackGround();
      requestAnimationFrame(start_end);
    }
  }


  function draw(){
    ctx.clearRect(0, 0, innerWidth, innerHeight);
    rpx = prompt("Укажите скорость мяча! Лучше всего указывать значение в диапазоне от 100 до 300.");
    if(mode == 2) {
      r = prompt("Укажите количество нейронов бота! Чем больше нейронов тем лучше будет играть бот. Лучше всего указывать значение в диапазоне от 10 до 20.");
      r /= 10;
      s = prompt("Укажите скорость бота! Чем больше скорость тем лучше будет играть бот. Лучше всего указывать значение в диапазоне от 3 до 30.");
      s /= 10;
    }
    if(mode == 3) {
      r = prompt("Укажите количество нейронов левого бота! Чем больше нейронов тем лучше будет играть бот. Лучше всего указывать значение в диапазоне от 10 до 20.");
      r /= 10;
      s = prompt("Укажите скорость левого бота! Чем больше скорость тем лучше будет играть бот. Лучше всего указывать значение в диапазоне от 3 до 30.");
      s /= 10;
      r2 = prompt("Укажите количество нейронов правого бота! Чем больше нейронов тем лучше будет играть бот. Лучше всего указывать значение в диапазоне от 10 до 20.");
      r2 /= 10;
      s2 = prompt("Укажите скорость правого бота! Чем больше скорость тем лучше будет играть бот. Лучше всего указывать значение в диапазоне от 3 до 30.");
      s2 /= 10;
    }
    game = setInterval(drawBackGround, 10);
  }

  function finish() {
    ctx.clearRect(0, 0, innerWidth, innerHeight);
    mode = 4;
    end = setInterval(drawFinish, 1000);
  }

  function drawFinish(){
    i++;
    if(i >= 5){
      location.reload();
    }
    console.log(i);
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#ffffff';
    ctx.font = '320% Trebuchet MS';
    ctx.textAlign = 'center';
    ctx.fillText('RIGHT PLAYER WIN!!!', canvas.width/2, canvas.height / 1.9);
  }

  function ffinish() {
    ctx.clearRect(0, 0, innerWidth, innerHeight);
    mode = 4;
    end = setInterval(drawFfinish, 1000);
  }

  function drawFfinish() {
    i++;
    if(i >= 5){
      location.reload();
    }
    console.log(i);
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#ffffff';
    ctx.font = '320% Trebuchet MS';
    ctx.textAlign = 'center';
    ctx.fillText('LEFT PLAYER WIN!!!', canvas.width/2 , canvas.height / 1.9);
  }





  function drawBackGround() {
    //console.log("mode: " + mode);
    canvas.width = innerWidth;
    canvas.height = innerHeight;
    //posY -= (canvas.height/(l*2));
    ctx.fillRect(0, 0, canvas.width/2, canvas.height);
    ctx.fillStyle = grad;
    //(canvas.height/(l*3))*1.6
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    if(mode == 2 || mode == 3 ) {
      //console.log("mode: " + mode);
      for (let i = 0; i < (l * r); i++) {
        rectN[i] = {
          r: ctx.fillRect(0, (canvas.height / (l * r)) * i, canvas.width, (canvas.height / (l * r)) * (i + 1)),
          k: 1
        }
      }
      if(mode == 3 ) {
        //console.log("mode: " + mode);
        for (let i = 0; i < (l * r2); i++) {
          rectN1[i] = {
            r: ctx.fillRect(0, (canvas.height / (l * r2)) * i, canvas.width, (canvas.height / (l * r2)) * (i + 1)),
            k: 1
          }
        }
      }
    }

    //console.log("mode: " + mode);
    if(mode == 1) {
      ctx.fillStyle = '#00b7d7';
      //console.log(posYBotC);
      ctx.fillRect(canvas.width / 20, posYBotC, canvas.width / 50, canvas.height / l);
      ctx.fillStyle = '#00b7d7';
      //console.log(posY);
      ctx.fillRect(canvas.width - canvas.width / 20, posY , canvas.width / 50, canvas.height / l);
    }
    if(mode == 2) {
      ctx.fillStyle = '#00b7d7';
      //console.log(posYBotC);
      ctx.fillRect(canvas.width / 20, posYBotC - (canvas.height / (l * 2)), canvas.width / 50, canvas.height / l);
      ctx.fillStyle = '#00b7d7';
//      console.log(posY);
      ctx.fillRect(canvas.width - canvas.width / 20, posY , canvas.width / 50, canvas.height / l);
   }
    if(mode == 3) {
      ctx.fillStyle = '#00b7d7';
      //console.log(posYBotC);
      ctx.fillRect(canvas.width / 20, posYBotC - (canvas.height / (l * 2)), canvas.width / 50, canvas.height / l);
      ctx.fillStyle = '#00b7d7';
      //console.log(posY);
      ctx.fillRect(canvas.width - canvas.width / 20, posY - (canvas.height / (l * 2)), canvas.width / 50, canvas.height / l);
    }
    for (let i = 0; i < arc.length; i++) {
      ctx.fillRect(arc[i].x, arc[i].y, canvas.width / 50, canvas.width / 50);
      ctx.fill();
    }

    if (score >= 7) {
      clearInterval(game);
      mode = 4;
      ctx.clearRect(0, 0, innerWidth, innerHeight);
      return finish();
      //location.reload();
    }
    if (scoreBot >= 7) {
      clearInterval(game);
      mode = 4;
      ctx.clearRect(0, 0, innerWidth, innerHeight);
      return ffinish();
      //location.reload();
    }
//console.log("mode: " + mode);
      let ballX = arc[0].x;
      let ballY = arc[0].y;
      if(ballX > canvas.width){
        console.log("posY  - (canvas.height / (l * 2)): " + (posY - (canvas.height / (l * 2))));
        console.log("posY: " + posY);
        console.log("ballY: " + ballY);
        console.log(dir2);
        dir2 = 0;
       ballX = canvas.width / 2;
       ballY = canvas.height / 2;
       scoreBot++;
       //window.navigator.vibrate([500, 10, 500]);
      }
      if(ballX < 0){
        console.log("posY  - (canvas.height / (l * 2)): " + (posY - (canvas.height / (l * 2))));
        console.log("posY: " + posY);
        console.log("ballY: " + ballY);
        console.log(dir2);
        dir2 = 0;
       ballX = canvas.width / 2;
       ballY = canvas.height / 2;
       score++;
        //window.navigator.vibrate([500, 10, 500]);
      }
      //posYBotC = (canvas.height/(l*3))*1.6;
      if(mode == 2 || mode == 3) {
        //console.log("mode: " + mode);
        for (let i = 0; i < (l * r); i++) {

          if (ballY >= (canvas.height / (l * r)) * i && ballY <= (canvas.height / (l * r)) * (i + 1)) {
            rectN[i].k = 0;
            neironball = rectN[i].k;
            neironballI = i;
          }
          if (posYBotC >= (canvas.height / (l * r)) * i && posYBotC < (canvas.height / (l * r)) * (i + 1)) {
            posYBotCI = i;
          }
        }
        //console.log(posYBotCI + ' posYBotCI');
        //console.log(neironballI + ' neironballI');
        if (posYBotCI == neironballI) {
          //console.log(posYBotCI + ' posYBotCI');
          //console.log(neironballI + ' neironballI');
        } else if (posYBotCI > neironballI) {
          posYBotC -= canvas.height / (rpx / s);
          //console.log(posYBotC + ' posYBotC');
          //console.log(posYBotCI + ' 126');
          //console.log(neironballI + ' neironballI');
        } else if (posYBotCI < neironballI) {
          posYBotC += canvas.width / (rpx / s);
          //console.log(posYBotC + ' posYBotC');
          //console.log(posYBotCI + '130');
          //console.log(neironballI + ' neironballI');
        }
        if(mode == 3){
          //console.log("mode: " + mode);
        for (let i = 0; i < (l * r2); i++) {

          if (ballY >= (canvas.height / (l * r2)) * i && ballY <= (canvas.height / (l * r2)) * (i + 1)) {
            rectN1[i].k = 0;
            neironball = rectN1[i].k;
            neironballI = i;
          }
          if (posY >= (canvas.height / (l * r2)) * i && posY < (canvas.height / (l * r2)) * (i + 1)) {
            posYI = i;
          }
        }
        //console.log(posYI + ' posYI');
          //console.log(ballY + ' ballY');
        console.log(neironballI + ' neironballI');
          console.log(posYI + ' posYI');
        if (posYI == neironballI) {
          console.log(posYBotCI + ' posYBotCI');
          console.log(neironballI + ' neironballI');
        } else if (posYI > neironballI) {
          posY -= canvas.height / (rpx / s2);
          console.log(posY + ' posY');
          console.log(posYI + ' posYI');
          console.log(neironballI + ' neironballI');
        } else if (posYI < neironballI) {
          posY += canvas.width / (rpx / s2);
          console.log(posY + ' posYBotC');
          console.log(posYI + '130');
          console.log(neironballI + ' neironballI');
        }
        }
      }
//console.log("mode: " + mode);
      //posYBotC = (canvas.height/(l*3))*1.6;
      //ballY -
      ctx.fillStyle = '#ffffff';
      ctx.font = '320% Trebuchet MS';
      ctx.textAlign = 'center';
      ctx.fillText(scoreBot + ' : ' + score, canvas.width / 1.95, canvas.height / 13 );
      //if (score >= 7) {
        //ctx.fillStyle = '#ffffff';
      //ctx.font = '320% Trebuchet MS';
      //ctx.fillText('You win!!!', canvas.width / 2.4, canvas.height / 5 );
      //}
      // if (scoreBot >= 7) {
      //   ctx.fillStyle = '#ffffff';
      // ctx.font = '320% Trebuchet MS';
      // ctx.fillText('Game Over!!!', canvas.width / 2.5, canvas.height / 5 );
      // }
//console.log("mode: " + mode);
      if(ballY <= 0 && dir2 == 5){
       dir2 = 6;
        if(isgp == 1) {
        }
       //window.navigator.vibrate([500, 100, 500]);
      }
      if(ballY <= 0 && dir2 == 1){
       dir2 = 2;
        if(isgp == 1) {
          Gamepad.vibrationActuator.playEffect('dual-rumble', {
            startDelay: 0,
            duration: 1000,
            weakMagnitude: 0.5,
            strongMagnitude: 1
          });
        }
       //window.navigator.vibrate([500, 100, 500]);
      }
      if(ballY >= canvas.height && dir2 == 6){
       dir2 = 5;
        if(isgp == 1) {
          Gamepad.vibrationActuator.playEffect('dual-rumble', {
            startDelay: 0, // Add a delay in milliseconds
            duration: 1000, // Total duration in milliseconds
            weakMagnitude: 0.5, // intensity (0-1) of the small ERM
            strongMagnitude: 1 // intesity (0-1) of the bigger ERM
          });
        }
       //window.navigator.vibrate([500, 100, 500]);
      }
      if(ballY >= canvas.height && dir2 == 2){
       dir2 = 1;
        if(isgp == 1) {
          Gamepad.vibrationActuator.playEffect('dual-rumble', {
            startDelay: 0, // Add a delay in milliseconds
            duration: 1000, // Total duration in milliseconds
            weakMagnitude: 0.5, // intensity (0-1) of the small ERM
            strongMagnitude: 1 // intesity (0-1) of the bigger ERM
          });
        }
       //window.navigator.vibrate([500, 100, 500]);
      }
      //console.log("mode: " + mode);
      if(mode == 1) {
        //console.log("mode: " + mode);
        if (ballX >= canvas.width - canvas.width / 20 - canvas.width / 50 && ballX <= canvas.width && ballY + canvas.width / 50 >= posY && ballY <= posY + canvas.height / (l * 3)) {
          dir2 = 5;
        }
        if (ballX >= canvas.width - canvas.width / 20 - canvas.width / 50 && ballX <= canvas.width && ballY + canvas.width / 50 >= posY + canvas.height / (l * 3) && ballY <= posY + (canvas.height / (l * 3)) * 2) {
          dir2 = 4;
        }
        if (ballX >= canvas.width - canvas.width / 20 - canvas.width / 50 && ballX <= canvas.width && ballY + canvas.width / 50 >= posY + (canvas.height / (l * 3)) * 2 && ballY <= posY + (canvas.height / (l * 3)) * 3) {
          dir2 = 6;
          console.log(dir2);
        }
        if (ballX <= canvas.width / 20 + canvas.width / 50 && ballX >= 0 && ballY + canvas.width / 50 >= posYBotC && ballY <= posYBotC + (canvas.height / (l * 3))) {
          dir2 = 1;
        }
        if (ballX <= canvas.width / 20 + canvas.width / 50 && ballX >= 0 && ballY + canvas.width / 50 >= posYBotC + (canvas.height / (l * 3)) && ballY <= posYBotC + (canvas.height / (l * 3)) * 2) {
          dir2 = 3;
        }
        if (ballX <= canvas.width / 20 + canvas.width / 50 && ballX >= 0 && ballY + canvas.width / 50 >= posYBotC + (canvas.height / (l * 3) * 2) && ballY <= posYBotC + (canvas.height / (l * 3)) * 3) {
          dir2 = 2;
        }
      }
      if(mode == 2) {
        //console.log("mode: " + mode);
        if (ballX >= canvas.width - canvas.width / 20 - canvas.width / 50 && ballX <= canvas.width && ballY + canvas.width / 50 >= posY && ballY <= posY + canvas.height / (l * 3)) {
          dir2 = 5;
          console.log("posY  - (canvas.height / (l * 2)): " + (posY - (canvas.height / (l * 2))));
          console.log("posY: " + posY);
          console.log("ballY: " + ballY);
          console.log(dir2);
        }
        if (ballX >= canvas.width - canvas.width / 20 - canvas.width / 50 && ballX <= canvas.width && ballY + canvas.width / 50 >= posY + canvas.height / (l * 3) && ballY <= posY + (canvas.height / (l * 3)) * 2) {
          dir2 = 4;
          console.log("posY  - (canvas.height / (l * 2)): " + (posY - (canvas.height / (l * 2))));
          console.log("posY: " + posY);
          console.log("ballY: " + ballY);
          console.log(dir2);
        }
        if (ballX >= canvas.width - canvas.width / 20 - canvas.width / 50 && ballX <= canvas.width && ballY + canvas.width / 50 >= posY + (canvas.height / (l * 3)) * 2 && ballY <= posY + (canvas.height / (l * 3)) * 3) {
          dir2 = 6;
          console.log("posY  - (canvas.height / (l * 2)): " + (posY - (canvas.height / (l * 2))));
          console.log("posY: " + posY);
          console.log("posY + (canvas.height / (l * 3)) * 3: " + (posY + (canvas.height / (l * 3)) * 3));
          console.log("ballY: " + ballY);
          console.log(dir2);
        }
        if (ballX <= canvas.width / 20 + canvas.width / 50) {
          if (ballX >= 0) {
            if (ballY + canvas.width / 50 >= posYBotC - (canvas.height / (l * 2))) {
              if (ballY <= posYBotC + (canvas.height / l)) {
                dir2 = Math.floor(Math.random() * 3 + 1);
              }
            }
          }
        }
      }
      if(mode == 3) {
        //console.log("mode: " + mode);

        if (ballX >= canvas.width - canvas.width / 20 - canvas.width / 50) {
          if (ballX <= canvas.width) {
            if (ballY + canvas.width / 50 >= posY  - (canvas.height / (l * 2))) {
              if (ballY <= posY + canvas.height / l) {
                dir2 = Math.floor(Math.random() * 3 + 4);
              }
            }
          }
        }
        if (ballX <= canvas.width / 20 + canvas.width / 50) {
          if (ballX >= 0) {
            if (ballY + canvas.width / 50 >= posYBotC - (canvas.height / (l * 2))) {
              if (ballY <= posYBotC + (canvas.height / l)) {
                dir2 = Math.floor(Math.random() * 3 + 1);
              }
            }
          }
        }
      }

      //posYBotC = ballY - (canvas.height/(l*3))*1.6;
//console.log("mode: " + mode);
     arc.pop();
    //console.log("rpx " + rpx);
    //console.log("canvas.width/rpx " + canvas.width/rpx);
    //console.log("canvas.height/rpx " + canvas.height/rpx);
    //console.log("posY  - (canvas.height / (l * 2)): " + (posY - (canvas.height / (l * 2))));
   // console.log("posY: " + posY);
   // console.log("ballY: " + ballY);
    if(dir2 == 5){
       //console.log(dir2);
       //console.log(rpx);
      // console.log("posY: " + posY);
       ballX -= canvas.width/rpx;
       ballY -= canvas.height/rpx;
     }
     if(dir2 == 6){
       console.log(dir2);
       //console.log("posY: " + posY);
       ballX -= canvas.width/rpx;
       ballY += canvas.height/rpx;
     }
     if(dir2 == 4){
       //console.log(dir2);
       ballX -= canvas.width/rpx;
     }
     if(dir2 == 1 ){
       //console.log(dir2);
       ballX += canvas.width/rpx;
       ballY -= canvas.height/rpx;
     }
     if(dir2 == 2 ){
       //console.log(dir2);
       ballX += canvas.width/rpx;
       ballY += canvas.height/rpx;
     }
     if(dir2 == 3 ){
       //console.log(dir2);
       ballX += canvas.width/rpx;
     }
     let newball = {
        x: ballX,
        y: ballY,
      }
     //console.log("mode: " + mode);
      arc.unshift(newball);

     let gp = navigator.getGamepads()[0];
     if(isgp == 1) {
       // if(posY <= canvas.height){
       for (let i = 0; i <= 17; i++) {
         if (gp.buttons[0].pressed == true) {
           console.log("checked!!! " + i);
         }
       }
       if (gp.buttons[0].value > 0 || gp.buttons[0].pressed == true || gp.buttons[0].value > 0 || gp.buttons[0].pressed == true) {
         if (dir2 == 0) {
           console.log("posY: " + posY);
           console.log("posYBotC: " + posYBotC);
           dir2 = 3;
         }
       }
       if (gp.axes[3] > 0.2 && gp.axes[3] < 0.4) {
         //v = gp.axes[1] * 2;
         if(posY + canvas.height / l >= canvas.height){
           posY = posY;
         } else {
           console.log("          1");
           posY += canvas.height / (rpx * 6);
         }
       }
       if (gp.axes[3] < -0.2 && gp.axes[3] > -0.4) {
         //v = gp.axes[1] * 2;
         if(posY <= 0){
           posY = posY;
         } else {
           console.log("  1");
           posY -= canvas.height / (rpx * 6);
         }
       }
       if (gp.axes[3] > 0.4 && gp.axes[3] < 0.6) {
         //v = gp.axes[1] * 2;
         if(posY + canvas.height / l >= canvas.height){
           posY = posY;
         } else {
           console.log("          2");
           posY += canvas.height / (rpx * 3);
         }
       }
       if (gp.axes[3] < -0.4 && gp.axes[3] > -0.6) {
         //v = gp.axes[1] * 2;
         if(posY <= 0){
           posY = posY;
         } else {
           console.log("  1");
           posY -= canvas.height / (rpx * 3);
         }
       }
       if (gp.axes[3] > 0.6 && gp.axes[3] < 0.95) {
         //v = gp.axes[1] * 2;
         if(posY + canvas.height / l >= canvas.height){
           posY = posY;
         } else {
           console.log("          3");
           posY += canvas.height / (rpx * 1.5);
         }
       }
       if (gp.axes[3] < -0.6 && gp.axes[3] > -0.95) {
         //v = gp.axes[1] * 2;
         if(posY <= 0){
           posY = posY;
         } else {
           console.log("  1");
           posY -= canvas.height / (rpx * 1.5);
         }
       }
       if (gp.axes[3] > 0.95 && gp.axes[3] <= 1) {
         //v = gp.axes[1] * 2;
         if(posY + canvas.height / l >= canvas.height){
           posY = posY;
         } else {
           console.log("          4");
           posY += canvas.height / (rpx * 0.5);
         }
       }
       if (gp.axes[3] < -0.95 && gp.axes[3] >= -1) {
         //v = gp.axes[1] * 2;
         if(posY <= 0){
           posY = posY;
         } else {
           console.log("  1");
           posY -= canvas.height / (rpx * 0.5);
         }
       }
       if (gp.axes[3] <= 0.2 && gp.axes[1] >= -0.2) {
         posY = posY;
       }
       if (mode == 1) {
       // if (gp.axes[1] > 0.2 && gp.axes[1] < 0.4) {
       //   posYBotC += canvas.height / (rpx);
       // }
       // if (gp.axes[1] < -0.2 && gp.axes[1] > -0.4) {
       //   posYBotC -= canvas.height / (rpx);
       // }
         if (gp.axes[1] > 0.2 && gp.axes[1] < 0.4) {
           //v = gp.axes[1] * 2;
           if(posYBotC + canvas.height / l >= canvas.height){
             posYBotC = posYBotC;
           } else {
             console.log("          1");
             posYBotC += canvas.height / (rpx * 6);
           }
         }
         if (gp.axes[1] < -0.2 && gp.axes[1] > -0.4) {
           //v = gp.axes[1] * 2;
           if(posYBotC <= 0){
             posYBotC = posYBotC;
           } else {
             console.log("          1");
             posYBotC -= canvas.height / (rpx * 6);
           }
         }
         if (gp.axes[1] > 0.4 && gp.axes[1] < 0.6) {
           //v = gp.axes[1] * 2;
           if(posYBotC + canvas.height / l >= canvas.height){
             posYBotC = posYBotC;
           } else {
             console.log("          1");
             posYBotC += canvas.height / (rpx * 3);
           }
         }
         if (gp.axes[1] < -0.4 && gp.axes[1] > -0.6) {
           //v = gp.axes[1] * 2;
           if(posYBotC <= 0){
             posYBotC = posYBotC;
           } else {
             console.log("          1");
             posYBotC -= canvas.height / (rpx * 3);
           }
         }
         if (gp.axes[1] > 0.6 && gp.axes[1] < 0.95) {
           //v = gp.axes[1] * 2;
           if(posYBotC + canvas.height / l >= canvas.height){
             posYBotC = posYBotC;
           } else {
             console.log("          1");
             posYBotC += canvas.height / (rpx * 1.5);
           }
         }
         if (gp.axes[1] < -0.6 && gp.axes[1] > -0.95) {
           //v = gp.axes[1] * 2;
           if(posYBotC <= 0){
             posYBotC = posYBotC;
           } else {
             console.log("          1");
             posYBotC -= canvas.height / (rpx * 1.5);
           }
         }
         if (gp.axes[1] > 0.95 && gp.axes[1] <= 1) {
           //v = gp.axes[1] * 2;
           if(posYBotC + canvas.height / l >= canvas.height){
             posYBotC = posYBotC;
           } else {
             console.log("          1");
             posYBotC += canvas.height / (rpx * 0.5);
           }
         }
         if (gp.axes[1] < -0.95 && gp.axes[1] >= -1) {
           //v = gp.axes[1] * 2;
           if(posYBotC <= 0){
             posYBotC = posYBotC;
           } else {
             console.log("          1");
             posYBotC -= canvas.height / (rpx * 0.5);
           }
         }
       if (gp.axes[1] <= 0.2 && gp.axes[1] >= -0.2) {
           posYBotC = posYBotC;
       }
     }
       //console.log("gp.buttons[0].value: " + gp.buttons[0].value)
       // if (gp.buttons[0].value > 0 || gp.buttons[0].pressed == true) {
       //   console.log("isgpif: " + isgp)
       //   if(posY <= canvas.height - (canvas.height / l)) {
       //     console.log("A");
       //     console.log("posY: " + posY);
       //     console.log("posYBotC: " + posYBotC);
       //     posY += canvas.height / (rpx);
       //   //enum GamepadHapticActuator.type {
       //     //  " vibration"
       //     //};
       //     let myActuatorType = GamepadHapticActuatorInstance.type;
       //     console.log("myActuatorType: " + myActuatorType);
       //     //Dom.gamepad-extensions.enabled = true;
       //     GamepadHapticActuator.pulse(1, 1000);
       //      gp.vibrationActuator.playEffect('dual-rumble', {
       //        startDelay: 0,
       //        duration: 1000,
       //        weakMagnitude: 0.5,
       //        strongMagnitude: 1
       //      });
       //   }
       // } else if (gp.buttons[3].value > 0 || gp.buttons[3].pressed == true) {
       //   if(posY >= 0) {
       //     console.log("Y");
       //     console.log("posY: " + posY);
       //     console.log("posYBotC: " + posYBotC);
       //     posY -= canvas.height / (rpx);
       //     //let myActuatorType = GamepadHapticActuatorInstance.type;
       //     //console.log("myActuatorType: " + myActuatorType);
       //     //GamepadHapticActuator.pulse(1, 1000);
       //   }
       // } else if (gp.buttons[2].value > 0 || gp.buttons[2].pressed == true || gp.buttons[1].value > 0 || gp.buttons[1].pressed == true) {
       //   if (dir2 == 0) {
       //     console.log("posY: " + posY);
       //     console.log("posYBotC: " + posYBotC);
       //     dir2 = 3;
       //     //let myActuatorType = GamepadHapticActuatorInstance.type;
       //     //console.log("myActuatorType: " + myActuatorType);
       //     //GamepadHapticActuator.pulse(1, 1000);
       //   }
       // } else if (gp.buttons[13].value > 0 || gp.buttons[13].pressed == true) {
       //   if(posYBotC <= canvas.height - (canvas.height / l)) {
       //     console.log("low");
       //     console.log("posY: " + posY);
       //     console.log("posYBotC: " + posYBotC);
       //     posYBotC += canvas.height / (rpx);
       //     let myActuatorType = gamepadHapticActuatorInstance.type;
       //     console.log("myActuatorType: " + myActuatorType);
       //     GamepadHapticActuator.pulse(1, 1000);
       //   }
       // } else if (gp.buttons[12].value > 0 || gp.buttons[12].pressed == true) {
       //   if(posYBotC >= 0) {
       //     console.log("up");
       //     console.log("posY: " + posY);
       //     console.log("posYBotC: " + posYBotC);
       //     posYBotC -= canvas.height / (rpx);
       //     Gamepad.vibrationActuator.playEffect('dual-rumble', {
       //       startDelay: 0,
       //       duration: 1000,
       //       weakMagnitude: 0.5,
       //       strongMagnitude: 1
       //     });
       //   }
       // }
     }
      document.addEventListener('keydown', ballMovement);
    document.addEventListener('mousedown', ballMovement2);
    if(mode == 2 || mode == 1) {
      canvas.addEventListener('mousemove', stickMovement);
    }
    //console.log("трандец!!!!!!!!!!... А потом ты понимаешь что здесь ошибка и говоришь ура!!!!!!!!!!");
    canvas.addEventListener('touchmove', touchStickMovement);
    if(mode == 2 || mode == 1) {
      window.addEventListener("gamepadconnected", function (e) {
        console.log(
                e.gamepad.buttons.indexOf, e.gamepad.axes.values);
        //for(let i = 0; i <= 17; i++ ){
        //if(gp.buttons[i].value > 0){
        //console.log("checked!!!");
        //}
        isgp = 1;

        //console.log(e);
        //let myActuatorType = GamepadHapticActuator.type;
        //console.log("myActuatorType: " + myActuatorType);
        //GamepadHapticActuator.pulse(1, 1000);
        //console.log(e);
        //isgp = 1;
        // if(navigator.webkitGetGamepads) {
        //   let gp = navigator.webkitGetGamepads()[0];
        //   console.log('con');
        //   if(gp.buttons[0] == 1) {
        //     console.log("A");
        //     posY += canvas.height / (rpx * 0.2);
        //   } else if(gp.buttons[1] == 1) {
        //     console.log("B");
        //     posY -= canvas.height / (rpx * 0.2);
        //   } else if(gp.buttons[2] == 1) {
        //     console.log("Y");
        //     posYBotC -= canvas.height / (rpx * 0.2);
        //   } else if(gp.buttons[3] == 1) {
        //     console.log("X");
        //     posYBotC += canvas.height / (rpx * 0.2);
        //   }
        // }else {
        //   let gp = navigator.getGamepads()[0];
        //
        //   if(gp.buttons[0].value > 0 || gp.buttons[0].pressed == true) {
        //     console.log("A");
        //     posY += canvas.height / (rpx * 0.2);
        //   } else if(gp.buttons[1].value > 0 || gp.buttons[1].pressed == true) {
        //     console.log("B");
        //     posY -= canvas.height / (rpx * 0.2);
        //   } else if(gp.buttons[2].value > 0 || gp.buttons[2].pressed == true) {
        //     console.log("X");
        //     posYBotC -= canvas.height / (rpx * 0.2);
        //   } else if(gp.buttons[3].value > 0 || gp.buttons[3].pressed == true) {
        //     console.log("Y");
        //     posYBotC += canvas.height / (rpx * 0.2);
        //   }
        // }
        //const xBoxButtonX = Gamepad.button[2];
        //const xBoxButtonA = Gamepad.buttons[0];
        //const xBoxButtonY = Gamepad.buttons[3];
        //const xBoxButtonUp = Gamepad.buttons[12];
        //const xBoxButtonLow = Gamepad.buttons[13];
        //if (xBoxButtonX.pressed) {
        // if(dir2 == 0) {
        //  dir2 = 3;
        //}
        //}
        //if (xBoxButtonA.pressed) {
        // posY += canvas.height / (rpx * 0.5);
        //}
        //if (xBoxButtonY.pressed) {
        // posY -= canvas.height / (rpx * 0.5);
        // }
        //if(mode == 1) {
        // if (xBoxButtonUp.pressed) {
        //  posYBotC -= canvas.height / (rpx * 0.5);
        //}
        //if (xBoxButtonLow.pressed) {
        //  posYBotC += canvas.height / (rpx * 0.5);
        //}
        //}
      });
      window.addEventListener("gamepaddisconnected", function (e) {
        console.log("Gamepad disconnected from index %d: %s",
                e.gamepad.index, e.gamepad.id);
      });
    }
    function ballMovement(event){
      if(event.keyCode == 13) {
        dir2 = 3;
      }
      // if(event.keyCode == 38) {
      //   //dir = 'up';
      //   posY -= canvas.height / (rpx * 1);
      //   console.log("PossssssY: " + posY);
      // }
      // if(event.keyCode == 40){
      //   //dir = 'down';
      //   posY += canvas.height / (rpx * 1);
      //   console.log("PossssssY: " + posY);
      // }
      // if(event.keyCode == 87) {
      //   //dir2 = 'up2';
      //   posYBotC -= canvas.height / (rpx * 1);
      //   console.log("PossssssBooooootC: " + posYBotC);
      // }
      // if(event.keyCode == 83) {
      //   //dir2 = 'down2';
      //   posYBotC += canvas.height / (rpx * 1);
      //   console.log("PossssssYBoooootC: " + posYBotC);
      // }
    }
    //console.log(d);

      function ballMovement2(event) {
        if (dir2 == 0) {
          dir2 = 3;
          console.log(dir2);
        }
      }

      function stickMovement(event) {
          //console.log("трандец!!!!!!!!!!... А потом ты понимаешь что здесь ошибка и говоришь ура!!!!!!!!!!");
        if(canvas.width / 2 < event.clientX) {
          ctx.fillStyle = '#00b7d7';
          ctx.fillRect(canvas.width - canvas.width / 20, event.clientY, canvas.width / 50, canvas.height / l);
          posY = event.clientY;
        }
        if (canvas.width / 2 > event.clientX) {
          ctx.fillStyle = '#00b7d7';
          ctx.fillRect(canvas.width / 20, event.clientY, canvas.width / 50, canvas.height / l);
          posYBotC = event.clientY;
        }
        }


      function touchStickMovement(event) {
        //touchPosition = { x: event.changedTouches[0].clientX, y: event.changedTouches[0].clientY };

          if (mode == 1) {
            if (canvas.width / 2 < event.changedTouches[0].clientX) {
              ctx.fillStyle = '#00b7d7';
              ctx.fillRect(canvas.width - canvas.width / 20, event.changedTouches[0].clientY, canvas.width / 50, canvas.height / l);
              posY = event.changedTouches[0].clientY;
            }
            if (canvas.width / 2 > event.changedTouches[0].clientX) {
              ctx.fillStyle = '#00b7d7';
              ctx.fillRect(canvas.width / 20, event.changedTouches[0].clientY, canvas.width / 50, canvas.height / l);
              posYBotC = event.changedTouches[0].clientY;
            }
          }
          if (mode == 2) {
            ctx.fillStyle = '#00b7d7';
            ctx.fillRect(canvas.width - canvas.width / 20, event.changedTouches[0].clientY, canvas.width / 50, canvas.height / l);
            posY = event.changedTouches[0].clientY;
          }
        }



    //console.log("mode: " + mode);
    //requestAnimationFrame(drawBackGround);
  }
  //drawBackGround();
</script>
</body>
</html>
